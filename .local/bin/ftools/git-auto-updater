#!/usr/bin/bash

. ~/.dotfiles/git-repo-paths

HAS_BEEN_UPDATED="no"
notify-send " git-auto-updater" "Checking for updates in your repos.."

function update_repo() {
	cd $1
	echo -e "\033[1m$1:\033[0m"
	git remote update

	UPSTREAM='@{u}'
	LOCAL=$(git rev-parse @)
	REMOTE=$(git rev-parse "$UPSTREAM")
	BASE=$(git merge-base @ "$UPSTREAM")

	if [ "$LOCAL" = "$REMOTE" ]; then
    		echo "Up-to-date"
	elif [ "$LOCAL" = "$BASE" ]; then
    		echo "Repo is behind, fetching remote..."
		git pull

		# If the repo folder is the dotfiles repo, symlink dotfiles just incase anything new 
		[ "$1" = "~/.dotfiles" ] && symlink-dotfiles
			
		# If the repo folder is the Pywalfox repo, move the updated files to your profile 
		[ "$1" = "~/Repos/Pywalfox" ] && load-firefox-css

		notify-send " git-auto-updater" " $1 was updated."
		HAS_BEEN_UPDATED="yes"
	elif [ "$REMOTE" = "$BASE" ]; then
    		echo "Need to push"
	else
    		echo "Diverged"
	fi

	echo ""	
}

for repo in ${REPOS[*]}; do update_repo $repo; done

[ "$HAS_BEEN_UPDATED" = "no" ] && notify-send " git-auto-updater" "All repos are up to date. No changes have been made."
