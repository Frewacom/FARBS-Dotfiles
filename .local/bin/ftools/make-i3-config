#!/usr/bin/bash

. "${HOME}/.dotfiles/.local/bin/ftools/make-wal-colors"
. "${HOME}/.dotfiles/profiles/$(whoami)/exports"

CONFIG_TEMPLATE_PATH=~/.dotfiles/.config/i3/config.template
CONFIG_PATH=~/.config/i3/config

function replace() {
    if [ -z "$2" ] || [ "$2" = "" ]; then
	# If the var is not set in the profile exports
	# use $3 instead (fallback value)
	sed -i "s/$1/$3/g" $CONFIG_PATH
    else
	sed -i "s/$1/$2/g" $CONFIG_PATH
    fi
}

# Remove if exists
[ -f $CONFIG_PATH ] && rm $CONFIG_PATH

cp $CONFIG_TEMPLATE_PATH $CONFIG_PATH

# These are not going to change via the profile
# placeholder			override			fallback
replace "<wal-light>" 		"$PROFILE_WAL_LIGHT" 		"$WAL_LIGHT"
replace "<wal-dark>" 		"$PROFILE_WAL_DARK"		"$WAL_DARK"
replace "<wal-bg-dark>" 	"$PROFILE_WAL_BG_DARK" 		"$WAL_BG_DARK"
replace "<wal-bg-light>" 	"$PROFILE_WAL_BG_LIGHT" 	"$WAL_BG_LIGHT"
replace "<wal-critical>" 	"$PROFILE_WAL_CRITICAL"		"$WAL_CRITICAL"
replace "<wal-critical-dark>" 	"$PROFILE_WAL_CRITICAL_DARK" 	"$WAL_CRITICAL_DARK"
replace "<wal-success>" 	"$PROFILE_WAL_SUCCESS" 		"$WAL_SUCCESS"

# These will be loaded from the profile
replace "<bar-background>" 	"$PROFILE_BAR_BACKGROUND" 	"$WAL_BG_MAIN_TRANSPARENT"
replace "<window-border-size>" 	"$PROFILE_WINDOW_BORDER_SIZE" 	"1"

replace "<gaps-inner>" 		"$PROFILE_GAPS_INNER" 		"4"
replace "<gaps-outer>" 		"$PROFILE_GAPS_OUTER" 		"2"

replace "<ws-emacs>" 		"$PROFILE_WS_EMACS"		$ws3
replace "<ws-spotify>"		"$PROFILE_WS_SPOTIFY" 		$ws5
replace "<ws-discord>" 		"$PROFILE_WS_DISCORD"		$ws7
replace "<ws-steam>" 		"$PROFILE_WS_STEAM"		$ws4
replace "<ws-firefox>" 		"$PROFILE_WS_FIREFOX"		$ws2
replace "<ws-code>" 		"$PROFILE_WS_CODE"		$ws6
replace "<ws-android-studio>"	"$PROFILE_WS_ANDROID_STUDIO"	$ws9
replace "<ws-ferdi>" "$PROFILE_WS_FERDI" $ws4

replace "<scratchpad-width>"	"$PROFILE_SP_WIDTH"		"800"
replace "<scratchpad-height>"	"$PROFILE_SP_HEIGHT"		"600"


i3-msg restart
