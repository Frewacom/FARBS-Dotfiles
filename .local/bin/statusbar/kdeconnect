#!/bin/bash

# NOTE:
# To use this block, set export KDE_DEVICE_ID="<your-device-id>"
# To get your device id, type "kdeconnect-cli -l" and find the name of your phone
# and copy the corresponding id.
# Logout and it should be loaded automatically and a pairing request from
# your phone to your computer should be accepted automatically

case $BLOCK_BUTTON in
    1) kdeconnect-dmenu & ;;
    3) notify-send " KDE Connect module" "\- Shows battery level of your phone.
- Left click opens kdeconnect-dmenu." & ;;
esac;

DESTINATION="org.kde.kdeconnect"
IBATTERY="org.kde.kdeconnect.device.battery.charge"
BATTERYPATH="/modules/kdeconnect/devices/$(xgetres kde.deviceId)"

filter() {
  grep 'int32 ..' | awk '{print $2}' | sed '1s/.*/ &/' | sed '/./ s/$/ %/'
}

dbus-send --print-reply --dest=$DESTINATION $BATTERYPATH $IBATTERY | filter

