#!/bin/sh

case $BLOCK_BUTTON in
  	1) mpc toggle &> /dev/null & ;;
  	2) setsid "$TERMINAL" -e ncmpcpp & ;;
  	3) notify-send " Music module" "\- Shows mpd song playing.
- Left click opens ncmpcpp.
- Middle click pauses.
- Scroll changes track.";;  # right click, pause/unpause
    4) mpc prev   ;;  # scroll up, previous
    5) mpc next   ;;  # scroll down, next
esac
# case $BLOCK_BUTTON in
#     # 1) mpc toggle;;  # right click, pause/unpause
#     # 2) setsid "$TERMINAL" -e ncmpcpp &  ;;  # right click, pause/unpause
#     # 3) mpc status && notify-send " Music module" "\- Shows mpd song playing.
# # - Left click opens ncmpcpp.
# # - Middle click pauses.
# # - Scroll changes track.";;  # right click, pause/unpause
#     # 4) mpc prev   ;;  # scroll up, previous
#     # 5) mpc next   ;;  # scroll down, next
# esac; exit

info=$(mpc)
lines=$(wc -l <<< "$info")

# Only print stuff if there is an active song
if [ "$lines" -gt 1 ]; then
  title=$(echo "$info" | sed 1q)
  playing=$(grep "playing" <<< "$info" )
  if [ -z "$playing" ]; then
    status=^c$(xgetres critical)^
  fi

  status=${status}" $title"

  # dwmblocks can only print a set amount of characters.
  # also makes sure very long titles are not displayed in full
  if [ $(wc -c <<< "$status") -gt 44 ]; then
    status="${status:0:40}"
    printf "$(awk '{$1=$1};1' <<< "$status")..."
  else
    printf "$status"
  fi

  echo ^d^
fi
